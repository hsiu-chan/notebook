---
toc:
    depth_from: 1
    depth_to: 3
html:
    offline: false
    embed_local_images: false #嵌入base64圖片
print_background: true
export_on_save:
    html: true
---

# 辨識

|   | N   | P   |
|-------------- | -------------- | -------------- |
| 真實N    | TN     | FP     |
| 真實P    | FN     | TP     |


$$
{\rm sensitivity}={\rm recall}=\frac{TP}{真實P}\\
$$
$$
{\rm specificity}=\frac{TN}{真實N}\\
$$
$$
{\rm precision}=\frac{TP}{P}
$$
$$
{\rm F-score}=\frac{2 {\rm recall}\cdot {\rm precision}}{{\rm recall+precision}}
$$

## 勝算比
$${\rm odds}=\frac{成功機率}{失敗機率}$$
### 先驗勝算
>篩檢前宣稱所有人都病，成功率為有病人數

$${\rm odds_{before}}=\frac{有病機率}{沒病機率}=\frac{有病人數}{沒病人數}$$

### 後驗勝算
>宣稱篩檢陽性的有病，成功率即精確度(precision)

$${\rm odds_{before}}=\frac{precision}{1-precision}＝\frac{真陽性人數}{偽陽性人數}$$

### Likelihood ratio
定義：
$$
{\rm odds_{after}}={\rm odds_{before}}\times {\rm Likelihood\ ratio}
$$

$$
={\rm odds_{before}}\times\frac{\rm 有病裏面被篩出陽性的比例}{\rm 沒病裏面被篩出陽性的比例}\\
$$
 所以
$${\rm Likelihood\ ratio}=\frac{有病裏面被篩出陽性的比例}{沒病裏面被篩出陽性的比例}$$


>RoC Curve 上一點斜率
![](paste_src/2023-04-17-14-43-43.png =100)
# 二項分布
n次中k次
$$
f(k,n,p)=\Pr(X=k)={n \choose k}p^{k}(1-p)^{n-k}\\
\operatorname {E} [X]=np\\
\operatorname {Var} [X]=np(1-p).
$$


# Beta distribution
定義在(0,1)區間的連續機率分布，有兩個母數$\alpha ,\beta >0$，即為先驗成功與失敗。把發生率p當作變數(x)，在現有數據下去預測p值是多少（即再做一次實驗），所以維護$\operatorname {E} [X]=\frac{\alpha}{\alpha +\beta}$, 變異數是二項分佈下的$\operatorname{E}[\frac{Y}{n}]$，所以$\operatorname {Var}(X)=\operatorname {E}(X-\mu )^{2}={\frac  {\alpha \beta }{(\alpha +\beta )^{2}(\alpha +\beta +1)}}$。
$$
{\begin{aligned}f(x;\alpha ,\beta )&={\frac  {x^{{\alpha -1}}(1-x)^{{\beta -1}}}{\int _{0}^{1}u^{{\alpha -1}}(1-u)^{{\beta -1}}\,du}}\\[6pt]&={\frac  {\Gamma (\alpha +\beta )}{\Gamma (\alpha )\Gamma (\beta )}}\,x^{{\alpha -1}}(1-x)^{{\beta -1}}\\[6pt]&={\frac  {1}{{\mathrm  {B}}(\alpha ,\beta )}}\,x^{{\alpha -1}}(1-x)^{{\beta -1}}\end{aligned}}
$$

:::note
Beta distribution 和二項分佈共軛
:::


# Poisson distribution
即做很多次($n\rightarrow \infty$)成功率p的白努力試驗，成功次數$\lambda=np$。卜瓦松分布適合於描述單位時間內隨機事件發生的次數的機率分布。


![](paste_src/2023-03-07-01-59-05.png =100)
![](paste_src/2023-03-07-02-08-27.png =70)

:::note {存活率 P(X=0)}
$$
\operatorname{P(X=0)}=\exp^{-\lambda}=\exp^{-hazard\times time}
$$
:::

    
# Gamma distribution
Poisson 的共軛，描述單位時間發生率分佈
$$
{\displaystyle f(x)={\frac {\beta ^{\alpha }}{\Gamma (\alpha )}}x^{\alpha -1}e^{-\beta x}}
$$

$$
\operatorname{E}[X]=\frac{\alpha}{\beta},\ 
\operatorname{Var}[X]=\frac{\alpha}{\beta^2}
$$

# 常態分佈
連續分佈，母數 $\mu, \sigma^2$
$$
f(x)=\frac{1}{\sqrt{2\pi\sigma}}\exp(-\frac{1}{2}(\frac{x-\mu}{\sigma})^2)
$$


$$
\phi(z)=\frac{1}{\sqrt{2\pi}}\exp(-\frac{z^2}{2})\\
\Phi(z)=\int_{-\infty}^{z} \phi(x)dx \rm\ \ (查表用)
$$


## 連續性校正
離散化要把離中間的密度分給兩邊。
Example: 逼近Bin Dist

$x \sim Bin,\ x'\sim N(\mu, \sigma^2)\\
P(x≤n)=P(x'\leq n+\frac{1}{2})$






# 抽樣分佈

每次抽 n 個sample x~1~...x~n~取平均 
$$
E(\bar{X})=\mu \\
Var(\bar{X})=\ \frac{1}{n^2}\sum Var(x_i) = \ \frac{\sigma^2}{n}
$$

>**Standard error** 
$Var(\bar{X})$ 

>**Hoeffding's inequality**
$$
x_i \in [a,b]\\
\mathbb{P}(\bar{X}-\mu \geq t)\ \leq\ \exp(-\frac{2t^2n^2}{n(a-b)^2})
$$


>**中央極限定理**
自任何母體中隨機抽取的樣本，其樣本平均數的抽樣分配，在樣本大小足夠大時，會趨近於常態分配。

:::example
**每次試驗為n次伯努力( x~Bin(1,&pi;) )，成功率&mu;**




$$
Var(\bar{x})=\frac{\pi(1-\pi)}{n}
$$

成功率 (95%區間)
$$
\mu + 1.96 \sqrt{\frac{\pi(1-\pi)}{n}}
$$

:::

# 假說檢定

假設H~0~為真，計算實驗結果出現率

Type1 error : H~0~ 對的但被拒絕 (95%以外的情況)

Type2 error : H~0~ 錯的但沒被拒絕

![](paste_src/2023-03-29-01-12-22.png =100)

##  統計檢定力

假設 H~1~正確，H~1~中真的拒絕H~0~的比例 (1-&beta;,紅色)

![](paste_src/2023-03-29-01-20-16.png =100)

## 樣本數估計

$$
C=\mu_0+Z_\alpha\frac{\sigma}{\sqrt{n}}\qquad({\rm Critical\ value})
$$

$$
Z_{1-\beta}=(C-\mu_1)/(\frac{\sigma}{\sqrt{n}})\qquad (統計檢定力)
$$

$$
\Rightarrow n=[\frac{Z_{1-\alpha}+Z_{1-\beta}}{\sigma^{-1}(\mu_0-\mu_1)}]^2=[\frac{Z_{1-\alpha}+Z_{1-\beta}}{\rm Effect\ size}]^2
$$

![](paste_src/2023-03-29-01-42-23.png =100)


:::example {Z test}
**已知變異數 &sigma;^2^，欲驗證差異 d。問達到檢定力 1-&beta;，顯著水準 &alpha;需多少樣本 n?**
$$
n=[\frac{Z_{1-\alpha}+Z_{1-\beta}}{\sigma^{-1}d}]^2
$$
:::


## Z test
- 母體σ已知，驗證母體平均為&mu;的機率
- 服從 Normal distribution



### 假說檢定

$H_0:\ x\sim N(\mu,\sigma^2)$
對於n個次試驗 $x_{i}$，

$$
\begin{aligned}
&Var(\bar{x})=\frac{n\sigma^2}{n^2}\\
\Rightarrow\ & {\rm Z-value}\\
&=\frac{\bar{x}-\mu}{\sigma_{\bar{x}}}=\frac{\bar{x}-\mu}{\sigma/\sqrt{n}}\sim N(1,0)
\end{aligned}
$$



## T test

### t-distribution
- 描述樣本的分佈
- 母數為==自由度==，從下方逼近常態分布(n 小則爛)

n 個 sample x~i~(自由度為n-1，因為用平均值正規化)

$$
S^2=\frac{\sum(x_i-\bar{x})^2}{n-1}
$$





### 假說檢定

$H_0:\ x\sim N(\mu,\sigma^2)$
對於n個次試驗 $x_{i}$，

$$
\begin{aligned}
&Var(\bar{x})=\frac{n\sigma^2}{n^2}\\
\Rightarrow\ &\frac{\bar{x}-\mu}{\sigma_{\bar{x}}}=\frac{\bar{x}-\mu}{\sigma/\sqrt{n}}\sim N(1,0)
\end{aligned}
$$


母群&sigma;^2^未知 &rarr; 用樣本變異數 S^2^
sample t-value= $\frac{\bar{x} - \mu}{S/\sqrt{自由度}} \sim T(自由度) $



:::tip
二項、Poisson 變異數不是母數，只需要Z test 
:::



## &chi; test

### &chi;²-distribution
#### Define
k個隨機變數 Z~i~ 是相互獨立、且
$$
Z_i \sim N(0,1)
$$

$$
X=\sum Z_i^2
$$
則
$$
X \sim \chi^2(k)
$$

#### Property

$$
E(X)=k\\
Var(X)=2k
$$

:::left
![](paste_src/2023-03-29-02-53-11.png =100)
:::right
![](paste_src/2023-03-29-02-53-27.png =100)
:::



### 假說檢定
對於變數 x，n個樣本 x~i~，H~0~: &sigma;^2^ = S^2^
則
$$
\frac{x_i-\bar{x}}{\sigma} \sim N(0,1)
$$
所以


$$
\frac{(n-1)S^2}{\sigma^2}=\sum_{i=1}^k (\frac{x_i-\bar{x}}{\sigma})^2 \sim \chi^2(n-1)
$$

根據 $\frac{(n-1)S^2}{\sigma^2}$ 對應到的累積機率就有p值 (H~0~成立機率)


## Two sample independent T-test
Y~1~,Y~2~平均&mu;~1~,&mu;~2~，且independent ,$cov(Y_1, Y_2)=0$
H~0~: &mu;~1~=&mu;~2~


### 假設Y~1~,Y~2~都來自變異數為&sigma;的母體

把 Y~1~,Y~2~ 放在一池 Y~p~

$$
\sigma^2=s_p^2=Var(\frac{(n_1-1)S_1^2+(n_2-1)S_2^2}{n_1+n_2-2})\\
$$

$$
=\frac{(n_1-1)S_1^2}{n_1+n_2-2}+\frac{(n_2-1)S_2^2}{n_1+n_2-2}
$$




考慮隨機變數&mu;~1~-&mu;~2~ 服從常態分佈 

$$
E[\mu_1-\mu_2]=0
$$

$$
\begin{aligned}
\sigma_{\mu{1}-\mu{2}}^2&=\sigma_{\mu_{1}}^2+\sigma_{\mu{2}}^2\\
&=\sigma_1^2n_{1}^{-1}+\sigma_2^2n_{2}^{-1}\\
&= s_p^2(n_1^{-1}+n_2^{-1})
\end{aligned}
$$

所以 

$$
{\rm T\ value}=\frac{\mu_1-\mu_2}{S_p\sqrt{n_1^{-1}+n_2^{-1}}}
$$


![](paste_src/2023-04-11-12-24-25.png =100)

## F 分佈 
比較亮個樣本的S
$$S_1^2\sim\frac{卡方分佈}{自由度}$$

$$
{\rm f-value}=\frac{S_1}{S_2}
$$


# ANOVA
處理多重比較Type I error 

k 組 定義 y~i,j~ 第i組第j個值

$$
\begin{aligned}
{\rm SST} =&\sum_{i,j}{(y_{ij}-\bar{\bar{y}})^2}\\
=&\sum_{i,j}{(y_{ij}-\bar{y_i}+\bar{y_i}-\bar{\bar{y}})^2}\\
=&\sum_{i,j}{(y_{ij}-\bar{y_i})^2}+\sum_{i,j}{(\bar{y_{i}}-\bar{\bar{y_i}})^2}+\sum_i (\bar{y_i}-\bar{\bar{y}})(\sum_j y_{ij}-\bar{y_i})\\
=&\sum_{i,j}{(y_{ij}-\bar{y_i})^2}+\sum_{i,j}{(\bar{y_{i}}-\bar{\bar{y_i}})^2}\\
=&{\rm SSW + SSB}
\end{aligned}
$$

檢定 SSB(df=k-1) , SSW(df=n-k) (單尾)

$$
MSB=SSB/k-1\\
MSW=SSW/n-k
$$

$$
F值 = \frac{MSB}{MSW} 
$$

>t^2^=F~1,n~